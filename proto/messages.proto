syntax = "proto3";

package meshara;

// Base message wrapper for all Meshara messages
message BaseMessage {
    uint32 version = 1;
    bytes message_id = 2;
    MessageType message_type = 3;
    int64 timestamp = 4;
    bytes sender_public_key = 5;
    bytes payload = 6;
    bytes signature = 7;
    optional RoutingInfo routing_info = 8;
}

// Message type enumeration
enum MessageType {
    BROADCAST = 0;
    PRIVATE_MESSAGE = 1;
    UPDATE_PACKAGE = 2;
    QUERY = 3;
    RESPONSE = 4;
}

// Routing information for multi-hop routing
message RoutingInfo {
    uint32 hop_count = 1;
    uint32 max_hops = 2;
    RouteType route_type = 3;
    optional bytes next_hop = 4;
    optional bytes onion_layers = 5;
}

// Route type enumeration
enum RouteType {
    DIRECT = 0;
    BRIDGE = 1;
    ONION_ROUTED = 2;
}

// Private message payload (encrypted)
message PrivateMessagePayload {
    bytes content = 1;
    bytes return_path = 2;
    bytes ephemeral_public_key = 3;
    bytes nonce = 4;
}

// Broadcast payload (signed, not encrypted)
message BroadcastPayload {
    bytes content = 1;
    string content_type = 2;
    map<string, string> metadata = 3;
}

// Update package (signed by authority)
message UpdatePackage {
    string version = 1;
    bytes package_data = 2;
    string changelog = 3;
    bytes checksum = 4;
    string required_version = 5;
    repeated bytes signatures = 6;
}

// Query message
message QueryMessage {
    bytes query_id = 1;
    string query_type = 2;
    bytes query_data = 3;
    bool response_required = 4;
}

// Response message
message ResponseMessage {
    bytes query_id = 1;
    bytes response_data = 2;
    ResponseCode response_code = 3;
}

// Response code enumeration
enum ResponseCode {
    SUCCESS = 0;
    NOT_FOUND = 1;
    ERROR = 2;
    UNAUTHORIZED = 3;
}
